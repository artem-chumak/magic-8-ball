<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Magic 8 ball</title>
    <meta name="author" content="Artem Chumak" />
    <meta
      name="description"
      content="The magic 8th ball that helps you make a decision"
    />
    <meta
      name="keywords"
      content="Magic, 8, eight, ball, decision, html, css, frontend, Artem, Chumak"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./images/favicon-16x16.png"
    />
    <link rel="manifest" href="manifest.json" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Magic 8 ball" />
    <meta
      property="og:description"
      content="The magic 8th ball that helps you make a decision"
    />
    <meta property="og:image" content="images/og.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:url"
      content="https://artem-chumak.github.io/magic-8-ball/"
    />
    <meta content="Magic 8 ball" property="twitter:title" />
    <meta
      content="The magic 8th ball that helps you make a decision"
      property="twitter:description"
    />
    <meta content="images/ogt.jpg" property="twitter:image" />
    <meta content="summary_large_image" name="twitter:card" />
  </head>

  <body>
    <div class="creds">
      Made by <a href="https://artchumak.ru/" target="_blank">Artem Chumak</a>
    </div>
    <div class="p-page">
      Project page on
      <a href="https://github.com/artem-chumak/magic-8-ball" target="_blank"
        >Github</a
      >
    </div>
    <div class="pwa-button">
      Set as <button type="button" id="pwa-button">PWA</button> on your device
    </div>
    <div class="shake-box">
      <p id="a-1">88</p>
      <p id="a-2">88</p>
      <p id="a-3">88</p>
      <p id="a-4">88</p>
      <p id="a-5">88</p>
      <p id="a-6">88</p>
      <p id="a-7">88</p>
      <p id="a-8">88</p>
      <p id="a-9">88</p>
    </div>
    <div class="shake-box-max">
      <p id="b-1">88</p>
      <p id="b-2">88</p>
      <p id="b-3">88</p>
      <p id="b-4">88</p>
      <p id="b-5">88</p>
      <p id="b-6">88</p>
      <p id="b-7">88</p>
      <p id="b-8">88</p>
      <p id="b-9">88</p>
    </div>
    <form>
      <!-- answers -->
      <input type="radio" name="answer" id="Yes" value="Yes" />
      <span>Yes</span>
      <input
        type="radio"
        name="answer"
        id="it seems to work"
        value=" it seems to work"
      />
      <span>It<br />seems<br />to work</span>
      <input
        type="radio"
        name="answer"
        id="Not this time"
        value="Not this time"
      />
      <span>Not this<br />time</span>
      <input type="radio" name="answer" id="Certainly" value="Certainly" />
      <span>Certainly</span>
      <input type="radio" name="answer" id="No" value="No" />
      <span>No</span>
      <input
        type="radio"
        name="answer"
        id="Have to wait"
        value="Have to wait"
      />
      <span>Have<br />to wait</span>
      <input type="radio" name="answer" id="Most likely" value="Most likely" />
      <span>Most<br />likely</span>
      <input type="radio" name="answer" id="Bad idea" value="Bad idea" />
      <span>Bad<br />idea</span>
      <input type="radio" name="answer" id="Definitely" value="Definitely" />
      <span>Definitely</span>
      <input
        type="radio"
        name="answer"
        id="Check and act"
        value="Check and act"
      />
      <span>Check<br />and act</span>
      <input type="radio" name="answer" id="Shake again" value="Shake again" />
      <span>Shake<br />again</span>
      <input type="radio" name="answer" id="Risky" value="Risky" />
      <span>Risky</span>
      <input
        type="radio"
        name="answer"
        id="Change the question"
        value="Change the question"
      />
      <span>Change the<br />question</span>
      <input type="radio" name="answer" id="Act" value="Act" />
      <span>Act</span>
      <input
        type="radio"
        name="answer"
        id="It's not easy"
        value="It's not easy"
      />
      <span>It's not<br />easy</span>
      <!-- THE BALL -->
      <div class="eight__backdrop"></div>
      <div class="eight">
        <!-- Front -->
        <div class="eight__fascia">
          <!-- drow 8 -->
          <div class="eight__number">8</div>
        </div>
        <!-- Back -->
        <div class="eight__fascia">
          <!-- Answer window -->
          <div class="eight__window"></div>
        </div>
        <!-- Answers table -->
        <ul>
          <li>
            <label for="Yes"></label>
          </li>
          <li>
            <label for="it seems to work"></label>
          </li>
          <li>
            <label for="Not this time"></label>
          </li>
          <li>
            <label for="Certainly"></label>
          </li>
          <li>
            <label for="No"></label>
          </li>
          <li>
            <label for="Have to wait"></label>
          </li>
          <li>
            <label for="Most likely"></label>
          </li>
          <li>
            <label for="Bad idea"></label>
          </li>
          <li>
            <label for="Definitely"></label>
          </li>
          <li>
            <label for="Check and act"></label>
          </li>
          <li>
            <label for="Shake again"></label>
          </li>
          <li>
            <label for="Risky"></label>
          </li>
          <li>
            <label for="Change the question"></label>
          </li>
          <li>
            <label for="Act"></label>
          </li>
          <li>
            <label for="It's not easy"></label>
          </li>
        </ul>
      </div>
      <!-- reset button -->
      <input type="reset" />
    </form>
    <script>
      // PWA SW logic
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("./sw.js")
          .then(function (registration) {
            console.log(
              "Service Worker registered with scope:",
              registration.scope
            );
          })
          .catch(function (error) {
            console.error("Service Worker registration failed:", error);
          });
      }
      // Set PWA button logit
      window.addEventListener("beforeinstallprompt", (event) => {
        console.log("Ready to set PWA");
        event.preventDefault();
        document.querySelector(".pwa-button").style.display = "block";
        deferredPrompt = event;
      });

      document.querySelector("#pwa-button").addEventListener("click", () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === "accepted") {
              console.log("Accepted PWA Installation");
            } else {
              console.log("Declined PWA Installation");
            }
            deferredPrompt = null;
          });
        }
      });

      // trying to do

      // const clickEvent = new MouseEvent("click", {
      //     bubbles: true,
      //     cancelable: true,
      //     view: window,
      //   });

      function shakeMagicBall() {
        const variants = document.querySelectorAll("label");
        const variantsCount = variants.length;
        const randomVariant = Math.floor(Math.random() * (variantsCount + 1));
        const element = variants[randomVariant];
        element.click();
        // element.dispatchEvent(clickEvent);
      }

      function resetMagicBall() {
        const reseter = document.querySelector('input[type="reset"]');
        // reseter.dispatchEvent(clickEvent);
        reseter.click();
        // console.log(reseter)
      }

      function shakeOnDevice() {
        const variants = document.querySelectorAll('input[type="radio"]');
        let atLeastOneChecked = false;
        variants.forEach((item) => {
          if (item.checked) {
            atLeastOneChecked = true;
          }
        });
        atLeastOneChecked ? resetMagicBall() : shakeMagicBall();
      }

      // if ("ondevicemotion" in window) {
      //   alert("working");
      // } else {
      //   alert("not working");
      // }

      // window.addEventListener("devicemotion", (event) => {
      //   console.log(`${event.acceleration.x} m/s2`);
      // });

      let maxAccelerationIncX = 0,
        maxAccelerationIncY = 0,
        maxAccelerationIncZ = 0,
        maxAccelerationX = 0,
        maxAccelerationY = 0,
        maxAccelerationZ = 0,
        maxRotateX = 0,
        maxRotateY = 0,
        maxRotateZ = 0;

      function isStrongShake(acceleration) {
        const threshold = 25;
        return (
          Math.abs(acceleration.x) > threshold ||
          Math.abs(acceleration.y) > threshold ||
          Math.abs(acceleration.z) > threshold
        );
      }

      window.addEventListener("devicemotion", (event) => {
        // document.querySelector(".shake-box").style.display = "flex";
        // document.querySelector(".shake-box-max").style.display = "flex";

        const accelerationIncludingGravity = event.accelerationIncludingGravity;
        const acceleration = event.acceleration;
        const rotationRate = event.rotationRate;

        // document.querySelector("#a-1").textContent = Math.floor(
        //   accelerationIncludingGravity.x
        // );
        // document.querySelector("#a-2").textContent = Math.floor(
        //   accelerationIncludingGravity.y
        // );
        // document.querySelector("#a-3").textContent = Math.floor(
        //   accelerationIncludingGravity.z
        // );
        // document.querySelector("#a-4").textContent = Math.floor(acceleration.x);
        // document.querySelector("#a-5").textContent = Math.floor(acceleration.y);
        // document.querySelector("#a-6").textContent = Math.floor(acceleration.z);
        // document.querySelector("#a-8").textContent = Math.floor(
        //   rotationRate.alpha
        // );
        // document.querySelector("#a-7").textContent = Math.floor(
        //   rotationRate.beta
        // );
        // document.querySelector("#a-9").textContent = Math.floor(
        //   rotationRate.gamma
        // );

        // if (accelerationIncludingGravity.x >= maxAccelerationIncX) {
        //   maxAccelerationIncX = accelerationIncludingGravity.x;
        // }

        // if (accelerationIncludingGravity.y >= maxAccelerationIncY) {
        //   maxAccelerationIncY = accelerationIncludingGravity.y;
        // }

        // if (accelerationIncludingGravity.z >= maxAccelerationIncZ) {
        //   maxAccelerationIncZ = accelerationIncludingGravity.z;
        // }

        // if (acceleration.x >= maxAccelerationX) {
        //   maxAccelerationX = acceleration.x;
        // }

        // if (acceleration.y >= maxAccelerationY) {
        //   maxAccelerationY = acceleration.y;
        // }

        // if (acceleration.z >= maxAccelerationZ) {
        //   maxAccelerationZ = acceleration.z;
        // }

        // if (rotationRate.alpha >= maxRotateX) {
        //   maxRotateX = rotationRate.alpha;
        // }

        // if (rotationRate.beta >= maxRotateY) {
        //   maxRotateY = rotationRate.beta;
        // }

        // if (rotationRate.gamma >= maxRotateZ) {
        //   maxRotateZ = rotationRate.gamma;
        // }

        // document.querySelector("#b-1").textContent =
        //   Math.floor(maxAccelerationIncX);
        // document.querySelector("#b-2").textContent =
        //   Math.floor(maxAccelerationIncY);
        // document.querySelector("#b-3").textContent =
        //   Math.floor(maxAccelerationIncZ);
        // document.querySelector("#b-4").textContent =
        //   Math.floor(maxAccelerationX);
        // document.querySelector("#b-5").textContent =
        //   Math.floor(maxAccelerationY);
        // document.querySelector("#b-6").textContent =
        //   Math.floor(maxAccelerationZ);
        // document.querySelector("#b-7").textContent = Math.floor(maxRotateX);
        // document.querySelector("#b-8").textContent = Math.floor(maxRotateY);
        // document.querySelector("#b-9").textContent = Math.floor(maxRotateZ);

        if (isStrongShake(accelerationIncludingGravity)) {
          shakeOnDevice();
        }
      });

      function flipOverDevice(gamma) {
        if (gamma > 80 || gamma < -80) {
          shakeOnDevice();
        }
      }

      window.addEventListener("deviceorientation", (event) => {
        const alpha = event.alpha; // угол вокруг оси Z (азимут)
        const beta = event.beta; // угол вокруг оси X (наклон вперед/назад)
        const gamma = event.gamma; // угол вокруг оси Y (наклон влево/вправо)

        document.querySelector("#a-8").textContent = Math.floor(alpha);
        document.querySelector("#a-7").textContent = Math.floor(beta);
        document.querySelector("#a-9").textContent = Math.floor(gamma);

        flipOverDevice(gamma);
        // if (alpha >= maxRotateX) {
        //   maxRotateX = alpha;
        // }

        // if (beta >= maxRotateY) {
        //   maxRotateY = beta;
        // }

        // if (gamma >= maxRotateZ) {
        //   maxRotateZ = gamma;
        // }

        // document.querySelector("#b-7").textContent = Math.floor(maxRotateX);
        // document.querySelector("#b-8").textContent = Math.floor(maxRotateY);
        // document.querySelector("#b-9").textContent = Math.floor(maxRotateZ);
      });

    </script>
  </body>
</html>
